/* ==================== DARK MODE VARIABLES ==================== */
:root {
    --primary-color: #7c3f69;
    --primary-dark:  #5f2e50;
    --primary-light: #9d5085;
    --primary-bg:    #f5e6f1;
    --gradient:      linear-gradient(135deg, #7c3f69 0%, #9d5085 100%);
    --shadow-sm: 0 2px 8px rgba(124,63,105,0.1);
    --shadow-md: 0 4px 16px rgba(124,63,105,0.15);
    --shadow-lg: 0 8px 24px rgba(124,63,105,0.2);
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);

    --fm-bg:           #ffffff;
    --fm-bg-alt:       #fafafa;
    --fm-border:       #e5e7eb;
    --fm-border-soft:  #f3f4f6;
    --fm-text:         #374151;
    --fm-text-head:    #5f2e50;
    --fm-text-sub:     #6b7280;
    --fm-text-muted:   #9ca3af;
    --fm-user-name:    #111827;
    --fm-input-bg:     #ffffff;
    --fm-th-bg:        #f9fafb;
    --fm-sort-bg:      #ffffff;
    --fm-sort-color:   #374151;
    --fm-btn-bg:       #ffffff;
    --fm-btn-color:    #374151;
    --fm-row-mobile:   #ffffff;
}

[data-theme="dark"] {
    --fm-bg:           #161b27;
    --fm-bg-alt:       #1a2035;
    --fm-border:       #2d4070;
    --fm-border-soft:  #1e2a45;
    --fm-text:         #e8e8f0;
    --fm-text-head:    #c4a0d0;
    --fm-text-sub:     #a0a8c0;
    --fm-text-muted:   #6070a0;
    --fm-user-name:    #e8e8f0;
    --fm-input-bg:     #1e2a45;
    --fm-th-bg:        #1e2a45;
    --fm-sort-bg:      #1e2a45;
    --fm-sort-color:   #a0a8c0;
    --fm-btn-bg:       #1e2a45;
    --fm-btn-color:    #a0a8c0;
    --fm-row-mobile:   #161b27;
}

/* ==================== REDUCE ANIMATIONS ==================== */
body.reduce-animations *,
body.reduce-animations *::before,
body.reduce-animations *::after {
    animation-duration:        0.01ms !important;
    animation-iteration-count: 1      !important;
    transition-duration:       0.1s   !important;
}

/* ==================== KEYFRAMES ==================== */
@keyframes fadeIn  { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }
@keyframes slideIn { from{opacity:0;transform:translateX(-20px)} to{opacity:1;transform:translateX(0)} }
@keyframes scaleIn { from{opacity:0;transform:scale(0.95)} to{opacity:1;transform:scale(1)} }
@keyframes pulse   { 0%,100%{transform:scale(1)} 50%{transform:scale(1.05)} }
@keyframes shimmer { 0%{background-position:-1000px 0} 100%{background-position:1000px 0} }

/* ==================== PAGE HEADER ==================== */
.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 32px;
    padding: 20px 0;
    animation: fadeIn 0.6s ease-out;
}

.header-content h2 {
    font-size: 32px;
    font-weight: 700;
    margin: 0 0 8px;
    background: var(--gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: slideIn 0.6s ease-out;
}

[data-theme="dark"] .header-content h2 {
    background: none;
    -webkit-background-clip: unset;
    -webkit-text-fill-color: unset;
    background-clip: unset;
    color: #d4a0c8;
    text-shadow: 0 0 30px rgba(212,160,200,0.25);
}

.header-content p {
    font-size: 15px;
    color: var(--fm-text-sub);
    margin: 0;
    animation: slideIn 0.6s ease-out 0.1s backwards;
    transition: color 0.3s;
}

.header-stats {
    display: flex;
    gap: 16px;
    animation: slideIn 0.6s ease-out 0.2s backwards;
}

.stat-card {
    background: var(--gradient);
    padding: 20px 28px;
    border-radius: 16px;
    text-align: center;
    box-shadow: var(--shadow-lg);
    min-width: 130px;
    position: relative;
    overflow: hidden;
    transition: var(--transition);
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0; left: -100%;
    width: 100%; height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.5s;
}

.stat-card:hover::before { left: 100%; }
.stat-card:hover { transform: translateY(-4px); box-shadow: 0 12px 32px rgba(124,63,105,0.3); }

.stat-number {
    display: block;
    font-size: 32px; font-weight: 800;
    color: #ffffff; line-height: 1;
    margin-bottom: 6px;
    animation: pulse 2s ease-in-out infinite;
}

.stat-label {
    display: block;
    font-size: 13px;
    color: rgba(255,255,255,0.95);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* ==================== TABLE CONTAINER ==================== */
.table-container {
    background: var(--fm-bg);
    border-radius: 20px;
    box-shadow: var(--shadow-md);
    overflow: hidden;
    animation: scaleIn 0.6s ease-out 0.3s backwards;
    transition: background 0.3s, box-shadow 0.3s;
    /* FIX: Fuerza a que todo baje en bloque para que la paginación no se ponga al lado */
    display: block;
    width: 100%; 
}

[data-theme="dark"] .table-container { box-shadow: 0 4px 20px rgba(0,0,0,0.4); }

/* ==================== TOOLBAR ==================== */
.table-toolbar {
    display: flex;
    flex-direction: column; /* ESTA ES LA CLAVE: Obliga a que siempre estén en filas separadas */
    padding: 24px 28px;
    border-bottom: 2px solid var(--fm-border-soft);
    gap: 16px;
    background: linear-gradient(to bottom, var(--fm-bg) 0%, var(--fm-bg-alt) 100%);
    transition: all 0.3s;
}

.search-box {
    position: relative;
    width: 100%; /* Forzamos a que tome todo el ancho de la tabla */
    max-width: 100%; /* Eliminamos el candado de 450px que tenía antes */
    animation: slideIn 0.5s ease-out 0.4s backwards;
}

.search-icon {
    position: absolute; left: 16px; top: 50%;
    transform: translateY(-50%);
    color: var(--primary-color);
    pointer-events: none;
    transition: var(--transition);
}

.search-input {
    width: 100%;
    padding: 12px 16px 12px 48px;
    border: 2px solid var(--fm-border);
    border-radius: 12px; font-size: 14px;
    transition: var(--transition);
    background: var(--fm-input-bg);
    color: var(--fm-text);
    box-sizing: border-box; /* Evita que la barra se desborde del contenedor */
}

.search-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 4px rgba(124,63,105,0.1);
}

.search-input::placeholder { color: var(--fm-text-muted); }

.filter-group {
    display: flex; 
    width: 100%; /* Obliga a usar todo el ancho disponible debajo de la barra */
    align-items: center; 
    justify-content: space-between; /* Distribuye: Izquierda, Centro, Derecha */
    flex-wrap: wrap;
    gap: 12px;
    animation: slideIn 0.5s ease-out 0.5s backwards;
}

.filter-select {
    padding: 12px 16px;
    border: 2px solid var(--fm-border);
    border-radius: 12px; font-size: 14px;
    background: var(--fm-input-bg);
    color: var(--fm-text);
    cursor: pointer; transition: var(--transition);
    min-width: 160px; font-weight: 500;
}

.filter-select:focus  { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 4px rgba(124,63,105,0.1); }
.filter-select:hover  { border-color: var(--primary-light); }

.sort-button {
    display: flex; align-items: center; gap: 8px;
    padding: 12px 18px;
    border: 2px solid var(--fm-border);
    border-radius: 12px;
    background: var(--fm-sort-bg); color: var(--fm-sort-color);
    font-size: 14px; font-weight: 600;
    cursor: pointer; transition: var(--transition);
}

.sort-button:hover {
    background: var(--primary-bg); border-color: var(--primary-color);
    color: var(--primary-color); transform: translateY(-2px); box-shadow: var(--shadow-sm);
}

[data-theme="dark"] .sort-button:hover { background: rgba(124,63,105,0.2); color: #d4a0c8; }
.sort-button:active { transform: translateY(0); }
.sort-button svg { transition: transform 0.3s; }
.sort-button[data-order="asc"] svg { transform: rotate(180deg); }

.export-button {
    display: flex; align-items: center; gap: 10px;
    padding: 12px 24px; border: none; border-radius: 12px;
    background: var(--gradient); color: #ffffff;
    font-size: 14px; font-weight: 700;
    cursor: pointer; transition: var(--transition);
    box-shadow: var(--shadow-md);
    text-transform: uppercase; letter-spacing: 0.5px;
}

.export-button:hover  { transform: translateY(-3px); box-shadow: 0 8px 24px rgba(124,63,105,0.4); }
.export-button:active { transform: translateY(-1px); }

/* ==================== TABLE ==================== */
.table-wrapper { 
    overflow-x: auto; 
    overflow-y: visible; 
    width: 100%; 
}

.admin-table { 
    width: 100%; 
    border-collapse: collapse; 
    font-size: 14px; 
}

.admin-table thead {
    background: linear-gradient(to bottom, var(--fm-th-bg) 0%, var(--fm-bg-alt) 100%);
    border-bottom: 2px solid var(--primary-color);
    transition: background 0.3s;
}

.admin-table th {
    padding: 18px 20px;
    text-align: left; font-weight: 700;
    color: var(--fm-text-head);
    font-size: 13px; text-transform: uppercase; letter-spacing: 0.8px;
    white-space: nowrap;
    position: sticky; top: 0; z-index: 10;
    background: var(--fm-th-bg);
    transition: background 0.3s, color 0.3s;
}

.admin-table th.sortable { cursor: pointer; user-select: none; transition: var(--transition); }
.admin-table th.sortable:hover { background: var(--primary-bg); color: var(--primary-color); }
[data-theme="dark"] .admin-table th.sortable:hover { background: rgba(124,63,105,0.2); color: #d4a0c8; }

.sort-icon { display: inline-block; margin-left: 6px; vertical-align: middle; opacity: 0.5; transition: var(--transition); }
.admin-table th.sortable:hover .sort-icon { opacity: 1; transform: translateY(-2px); }

.admin-table tbody tr {
    border-bottom: 1px solid var(--fm-border);
    transition: var(--transition);
    animation: fadeIn 0.4s ease-out backwards;
}

.admin-table tbody tr:hover { 
    box-shadow: inset 3px 0 0 var(--primary-color), 0 4px 12px rgba(124,63,105,0.06); 
    background: var(--fm-bg-alt);
}
[data-theme="dark"] .admin-table tbody tr:hover { 
    background: rgba(30,42,69,0.4); 
    box-shadow: inset 3px 0 0 #d4a0c8, 0 4px 12px rgba(0,0,0,0.3);
}

.admin-table td { 
    padding: 20px; 
    color: var(--fm-text); 
    transition: color 0.3s; 
    white-space: nowrap; 
}

/* Checkbox */
.th-checkbox, .td-checkbox { width: 50px; padding-left: 28px !important; }
input[type="checkbox"] { width:20px; height:20px; cursor:pointer; accent-color:var(--primary-color); transition:var(--transition); }
input[type="checkbox"]:hover { transform: scale(1.1); }

/* User info */
.user-info { display:flex; align-items:center; gap:14px; }

.user-avatar {
    width:42px; height:42px; border-radius:50%;
    background: var(--gradient); color:#ffffff;
    display:flex; align-items:center; justify-content:center;
    font-weight:700; font-size:16px; flex-shrink:0;
    box-shadow:var(--shadow-sm); transition:var(--transition);
}

.user-avatar:hover { transform:rotate(360deg) scale(1.1); box-shadow:var(--shadow-md); }
.user-name { font-weight:600; color:var(--fm-user-name); transition:var(--transition); }
.user-info:hover .user-name { color:var(--primary-color); }
[data-theme="dark"] .user-info:hover .user-name { color:#d4a0c8; }

/* Links */
.email-link, .phone-link { color:var(--fm-text-sub); text-decoration:none; transition:var(--transition); position:relative; }
.email-link::after, .phone-link::after { content:''; position:absolute; bottom:-2px; left:0; width:0; height:2px; background:var(--primary-color); transition:width 0.3s; }
.email-link:hover, .phone-link:hover { color:var(--primary-color); }
.email-link:hover::after, .phone-link:hover::after { width:100%; }
[data-theme="dark"] .email-link:hover, [data-theme="dark"] .phone-link:hover { color:#d4a0c8; }

/* Asunto */
.subject-text { 
    color:var(--fm-text-sub); 
    transition:var(--transition); 
    display: inline-block;
    max-width: 250px;
    overflow: hidden;
    text-overflow: ellipsis;
    vertical-align: middle;
}
tr:hover .subject-text { color:var(--fm-text); }
.text-muted { color:var(--fm-text-muted); }

/* Date badge */
.date-badge {
    display:inline-block; padding:6px 14px;
    background:var(--primary-bg); color:var(--primary-dark);
    border-radius:8px; font-size:13px; font-weight:600;
    transition:var(--transition); border:1px solid transparent;
}

[data-theme="dark"] .date-badge { background:rgba(124,63,105,0.2); color:#d4a0c8; }
tr:hover .date-badge { background:var(--gradient); color:#ffffff; transform:translateY(-2px); box-shadow:var(--shadow-sm); }

/* Actions */
.th-actions { width:120px; text-align:center; }
.td-actions  { text-align:center; }
.action-buttons { display:flex; gap:8px; justify-content:center; }

.btn-action {
    width:38px; height:38px; border:none; border-radius:10px;
    display:flex; align-items:center; justify-content:center;
    cursor:pointer; transition:var(--transition); position:relative; overflow:hidden;
}

.btn-action::before { content:''; position:absolute; top:50%; left:50%; width:0; height:0; border-radius:50%; background:rgba(255,255,255,0.5); transform:translate(-50%,-50%); transition:width 0.3s,height 0.3s; }
.btn-action:hover::before { width:100px; height:100px; }

.btn-view   { background:#dbeafe; color:#1e40af; }
.btn-view:hover   { background:#1e40af; color:#ffffff; transform:translateY(-3px) rotate(5deg); box-shadow:0 4px 12px rgba(30,64,175,0.3); }
.btn-delete { background:#fee2e2; color:#dc2626; }
.btn-delete:hover { background:#dc2626; color:#ffffff; transform:translateY(-3px) rotate(-5deg); box-shadow:0 4px 12px rgba(220,38,38,0.3); }

[data-theme="dark"] .btn-view   { background:rgba(30,64,175,0.2); color:#93c5fd; }
[data-theme="dark"] .btn-delete { background:rgba(220,38,38,0.2);  color:#fca5a5; }

/* Empty state */
.empty-state { text-align:center; padding:80px 20px !important; animation:fadeIn 0.6s ease-out; }
.empty-content svg { margin-bottom:20px; animation:pulse 2s ease-in-out infinite; }
.empty-content p   { color:var(--fm-text-muted); font-size:16px; margin:0; font-weight:500; }

/* ==================== FOOTER ==================== */
.table-footer {
    display:flex; justify-content:space-between; align-items:center;
    padding:20px 28px;
    border-top: 2px solid var(--fm-border-soft);
    background: linear-gradient(to top, var(--fm-bg) 0%, var(--fm-bg-alt) 100%);
    transition: all 0.3s;
    width: 100%;
}

.footer-info { font-size:14px; color:var(--fm-text-sub); font-weight:500; transition:color 0.3s; }
.footer-info strong { color:var(--primary-color); font-weight:700; }
[data-theme="dark"] .footer-info strong { color:#d4a0c8; }

.pagination { display:flex; gap:8px; }

.page-btn {
    padding:10px 18px;
    border:2px solid var(--fm-border); border-radius:10px;
    background:var(--fm-btn-bg); font-size:14px; font-weight:600;
    color:var(--fm-btn-color); cursor:pointer; transition:var(--transition);
}

.page-btn:hover:not(:disabled) { background:var(--primary-bg); border-color:var(--primary-color); color:var(--primary-color); transform:translateY(-2px); box-shadow:var(--shadow-sm); }
[data-theme="dark"] .page-btn:hover:not(:disabled) { background:rgba(124,63,105,0.2); color:#d4a0c8; }
.page-btn:disabled { opacity:0.4; cursor:not-allowed; }
.page-btn.active   { background:var(--gradient); border-color:var(--primary-color); color:#ffffff; font-weight:700; box-shadow:var(--shadow-md); }

/* ==================== RESPONSIVE ==================== */
@media (max-width: 1024px) {
    .page-header { flex-direction: column; align-items: flex-start; gap: 20px; }
    .header-stats { width: 100%; justify-content: space-between; }
    .stat-card { flex: 1; min-width: 0; }
    .table-toolbar { flex-direction: column; align-items: stretch; }
    
    /* Esta es la línea que debes asegurar que tenga space-between */
    .filter-group { width: 100%; justify-content: space-between; } 
}

/* ==================== VISTA INTERMEDIA (INTERCALADA PREMIUM) ==================== */
@media (max-width: 1150px) and (min-width: 769px) {
    .table-wrapper { overflow-x: hidden; }
    .admin-table thead { display: none; } 
    
    .admin-table tbody tr {
        display: grid;
        grid-template-columns: 40px 60px minmax(200px, 1.3fr) minmax(180px, 1fr) auto;
        grid-template-rows: auto auto; 
        gap: 6px 16px;
        padding: 24px 28px;
        border-bottom: 1px solid var(--fm-border-soft);
        align-items: center;
    }

    .admin-table td { padding: 0 !important; border: none !important; white-space: normal; }
    .admin-table td:nth-child(2), .user-info { display: contents; }

    .td-checkbox { 
        grid-column: 1; grid-row: 1 / span 2; 
        padding: 0 !important; display: flex; align-items: center; 
    }
    
    .user-avatar { 
        grid-column: 2; grid-row: 1 / span 2; 
        width: 48px; height: 48px; font-size: 18px; 
        align-self: center; justify-self: center;
    }
    
    .user-name { 
        grid-column: 3; grid-row: 1; 
        align-self: end; font-size: 15px; font-weight: 700; color: var(--fm-user-name); 
    }
    
    .admin-table td:nth-child(3) { 
        grid-column: 3; grid-row: 2; align-self: start; 
    }
    .admin-table td:nth-child(3) a { font-size: 13px; color: var(--fm-text-sub); }
    
    .admin-table td:nth-child(4) { 
        grid-column: 4; grid-row: 1; align-self: end; 
    }
    .subject-text { font-weight: 600; font-size: 14px; max-width: 100%; color: var(--fm-text); }
    
    .admin-table td:nth-child(5) { 
        grid-column: 4; grid-row: 2; align-self: start; 
    }
    .admin-table td:nth-child(5) a { font-size: 13px; color: var(--fm-text-sub); }
    
    .admin-table td:nth-child(6) { 
        grid-column: 5; grid-row: 1; justify-self: end; align-self: end; 
    }
    
    .td-actions { 
        grid-column: 5; grid-row: 2; justify-self: end; align-self: start; padding-top: 4px !important; 
    }
}

/* ==================== VISTA MÓVIL (TARJETAS) ==================== */
@media (max-width: 768px) {
    .header-content h2 { font-size: 24px; }
    .stat-card { padding: 16px 20px; }
    .stat-number { font-size: 28px; }

    .table-wrapper { overflow-x: visible; }
    .admin-table thead { display: none; }
    
    .admin-table, .admin-table tbody, .admin-table tr { display: block; width: 100%; }

    .admin-table tbody tr {
        display: flex;
        flex-direction: column;
        margin-bottom: 20px;
        border: 2px solid var(--fm-border);
        border-radius: 16px; 
        padding: 16px;
        background: var(--fm-row-mobile);
        box-shadow: var(--shadow-sm);
        transition: transform 0.3s, box-shadow 0.3s;
    }

    .admin-table tbody tr:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); border-left-color: var(--fm-border); }

    .admin-table td { 
        display: grid; 
        grid-template-columns: 90px 1fr; 
        gap: 16px; 
        padding: 14px 0 !important; 
        border-bottom: 1px solid var(--fm-border-soft) !important;
        align-items: center; 
        text-align: right; 
        white-space: normal; 
        word-break: break-word; 
    }

    .admin-table td:last-child { border-bottom: none !important; }

    .admin-table td::before { 
        content: attr(data-label); 
        font-weight: 700; 
        color: var(--primary-color); 
        text-transform: uppercase; 
        font-size: 12px; 
        letter-spacing: 0.5px; 
        text-align: left; 
    }
    [data-theme="dark"] .admin-table td::before { color: #d4a0c8; }

    .user-info { justify-content: flex-end; }
    .action-buttons { justify-content: flex-end; }
    .subject-text { max-width: 100%; white-space: normal; }

    .td-checkbox { 
        display: flex !important; 
        justify-content: flex-end; 
        padding: 0 0 10px 0 !important; 
        border-bottom: none !important;
    }
    .td-checkbox::before { content: none; }

    .table-footer { flex-direction: column; gap: 16px; align-items: stretch; text-align: center; }
    .pagination { justify-content: center; }
    .filter-group { flex-direction: column; }
    .filter-select, .sort-button, .export-button { width: 100%; justify-content: center; }
}

@media (max-width: 480px) {
    .header-content h2 { font-size: 20px; }
    .stat-card { padding: 12px 16px; }
    .stat-number { font-size: 24px; }
    .stat-label { font-size: 11px; }
    .table-container { border-radius: 16px; }
    .table-toolbar { padding: 16px; }
    .admin-table td { grid-template-columns: 75px 1fr; gap: 10px; }
}
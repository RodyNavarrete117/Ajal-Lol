/* ==================== DARK MODE VARIABLES ==================== */
:root {
    --rpt-bg:           #ffffff;
    --rpt-bg-soft:      #f7fafc;
    --rpt-border:       #e2e8f0;
    --rpt-text:         #2d3748;
    --rpt-text-sub:     #4a5568;
    --rpt-text-muted:   #718096;
    --rpt-nav-bg:       #f7fafc;
    --rpt-input-bg:     #f7fafc;
    --rpt-table-bg:     #ffffff;
    --rpt-row-hover:    #f7fafc;
    --rpt-filter-bg:    #e2e8f0;
    --rpt-filter-color: #4a5568;
    --rpt-history-bg:   #e8d5e4;
    --rpt-history-h4:   #2d3748;
    --rpt-history-date: #4a5568;
    --rpt-modal-bg:     linear-gradient(135deg, #f4e8f1 0%, #fceef8 100%);
    --rpt-modal-h3:     #2d3748;
    --rpt-modal-p:      #4a5568;
    --rpt-close-bg:     rgba(255,255,255,0.9);
    --rpt-btn-bg:       #ffffff;
    --rpt-shadow:       0 4px 16px rgba(237, 112, 112, 0.08);
    --rpt-shadow-btn:   0 2px 8px rgba(0,0,0,0.1);
}

[data-theme="dark"] {
    --rpt-bg:           #161b27;
    --rpt-bg-soft:      #1e2a45;
    --rpt-border:       #2d4070;
    --rpt-text:         #e8e8f0;
    --rpt-text-sub:     #a0a8c0;
    --rpt-text-muted:   #6070a0;
    --rpt-nav-bg:       #1e2a45;
    --rpt-input-bg:     #1e2a45;
    --rpt-table-bg:     #161b27;
    --rpt-row-hover:    #1e2a45;
    --rpt-filter-bg:    #1e2a45;
    --rpt-filter-color: #a0a8c0;
    --rpt-history-bg:   #1e2a45;
    --rpt-history-h4:   #e8e8f0;
    --rpt-history-date: #a0a8c0;
    --rpt-modal-bg:     linear-gradient(135deg, #1a1030 0%, #16213e 100%);
    --rpt-modal-h3:     #e8e8f0;
    --rpt-modal-p:      #a0a8c0;
    --rpt-close-bg:     rgba(30,42,69,0.95);
    --rpt-btn-bg:       #1e2a45;
    --rpt-shadow:       0 4px 16px rgba(0,0,0,0.4);
    --rpt-shadow-btn:   0 2px 8px rgba(0,0,0,0.3);
}

/* REGLA MAESTRA PARA ICONOS (SOLUCIÓN AL MODO OSCURO) */
.btn-back svg, 
.btn-action svg, 
.btn-nav svg, 
.btn-edit-input svg, 
.btn-calendar svg, 
.btn-form svg,
.btn-modal svg,
.btn-close-modal svg,
.btn-print-small svg {
    stroke: currentColor !important; /* El icono ahora siempre seguirá el color de la letra */
}

/* Forzamos blanco puro solo en modo oscuro */
[data-theme="dark"] .btn-back,
[data-theme="dark"] .btn-nav,
[data-theme="dark"] .btn-edit-input,
[data-theme="dark"] .btn-calendar,
[data-theme="dark"] .btn-close-modal,
[data-theme="dark"] .btn-print-small {
    color: #ffffff !important;
}

.reports-container { padding: 2rem; max-width: 1400px; margin: 0 auto; min-height: 100vh; }

.view-section { display: none; animation: fadeIn 0.4s ease-out; }
.view-section.active { display: block; }

.reports-header { display: flex; align-items: center; gap: 2rem; margin-bottom: 2rem; flex-wrap: wrap; }
.reports-header h2 { font-size: 1.8rem; font-weight: 700; color: var(--rpt-text); flex: 1; transition: color 0.3s ease; }

.btn-back { width: 44px; height: 44px; border: 1px solid var(--rpt-border); background: var(--rpt-bg); border-radius: 12px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease; box-shadow: var(--rpt-shadow-btn); color: var(--rpt-text-sub); }
.btn-back:hover { background: var(--rpt-bg-soft); transform: translateX(-4px); color: var(--rpt-text); }
.btn-back svg { width: 24px; height: 24px; transition: stroke 0.3s ease; }

.header-actions { display: flex; gap: 1rem; margin-left: auto; }

.btn-action { padding: 0.9rem 1.5rem; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 0.6rem; transition: all 0.3s ease; box-shadow: var(--rpt-shadow-btn); }
.btn-action svg { width: 20px; height: 20px; }

.btn-create { background: linear-gradient(135deg, #783d66 0%, #5a2d4d 100%); color: white; }
.btn-create:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(120,61,102,0.3); }

.btn-history { background: var(--rpt-btn-bg); color: #783d66; border: 2px solid #783d66; }
[data-theme="dark"] .btn-history { color: #c47aaa; border-color: #c47aaa; }
.btn-history:hover { background: #783d66; color: white; transform: translateY(-2px); }

/* ==================== CALENDARIO (MÁS COMPACTO Y ELEGANTE) ==================== */
.calendar-wrapper { 
    background: var(--rpt-bg); 
    border-radius: 20px; 
    padding: 2rem; /* Redujimos un poco el padding */
    box-shadow: var(--rpt-shadow); 
    max-width: 950px; /* Contenedor general más compacto */
    margin: 0 auto; 
    border: 1px solid var(--rpt-border); 
    transition: background 0.3s ease, border-color 0.3s ease; 
    display: grid;
    grid-template-columns: 1.5fr 1fr; /* Proporción más equilibrada */
    gap: 0 2rem; 
}

.calendar-header { 
    grid-column: 1; 
    display: flex; 
    align-items: center; 
    justify-content: space-between; 
    margin-bottom: 1.5rem; 
}
.calendar-header h3 { font-size: 1.3rem; font-weight: 700; color: var(--rpt-text); transition: color 0.3s ease; }

.btn-nav { width: 36px; height: 36px; border: none; background: var(--rpt-nav-bg); border-radius: 10px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease; color: var(--rpt-text-sub); }
.btn-nav:hover { background: #783d66; color: white; }
.btn-nav svg { width: 18px; height: 18px; transition: stroke 0.3s ease; }

.calendar-grid { 
    grid-column: 1; 
    margin-bottom: 0; 
    max-width: 480px; /* EL SECRETO: Evita que la cuadrícula se estire infinitamente */
    margin-left: auto;
    margin-right: auto;
    width: 100%;
}

.calendar-days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.5rem; margin-bottom: 0.5rem; }
.day-header { text-align: center; font-weight: 600; color: var(--rpt-text-sub); padding: 0.5rem; font-size: 0.8rem; transition: color 0.3s ease; }
.day-short { display: none; }
.calendar-dates { display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.4rem; }

/* Los días ahora tienen altura controlada y no son cuadrados gigantes */
.calendar-date { 
    height: 50px; /* Altura fija en lugar de aspect-ratio */
    display: flex; align-items: center; justify-content: center; 
    border-radius: 10px; cursor: pointer; transition: all 0.3s ease; 
    font-weight: 500; position: relative; font-size: 0.9rem; color: var(--rpt-text); 
}
.calendar-date:hover { background: var(--rpt-bg-soft); transform: translateY(-2px); }
.calendar-date.other-month { color: var(--rpt-text-muted); }
.calendar-date.has-event { background: linear-gradient(135deg, #783d66 0%, #5a2d4d 100%); color: white; font-weight: 700; box-shadow: 0 4px 10px rgba(120,61,102,0.2); }
.calendar-date.has-event::after { content: ''; position: absolute; bottom: 6px; width: 5px; height: 5px; background: white; border-radius: 50%; }
.calendar-date.selected { background: #783d66; color: white; box-shadow: 0 4px 10px rgba(120,61,102,0.3); }

/* NOTAS PANEL DERECHO */
.calendar-notes { 
    grid-column: 2; 
    grid-row: 1 / span 2; 
    border-top: none; 
    border-left: 2px solid var(--rpt-border); 
    padding-top: 0; 
    padding-left: 2rem; 
    display: flex;
    flex-direction: column;
    transition: border-color 0.3s ease; 
}
.calendar-notes h4 { font-size: 0.85rem; font-weight: 700; color: var(--rpt-text-muted); margin-bottom: 1.2rem; letter-spacing: 1px; transition: color 0.3s ease; }
.notes-content { color: var(--rpt-text-sub); line-height: 1.6; font-size: 0.9rem; transition: color 0.3s ease; flex: 1;}

/* MODAL EVENTO */
.event-modal { position: fixed; top: 0; right: -100%; width: 100%; max-width: 400px; height: 100vh; background: var(--rpt-modal-bg); box-shadow: -4px 0 20px rgba(0,0,0,0.15); z-index: 1000; transition: right 0.4s cubic-bezier(0.4,0,0.2,1); display: flex; flex-direction: column; overflow-y: auto; }
[data-theme="dark"] .event-modal { box-shadow: -4px 0 30px rgba(0,0,0,0.5); }
.event-modal.active { right: 0; }

.event-modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: rgba(0,0,0,0.5); z-index: 999; opacity: 0; visibility: hidden; transition: all 0.3s ease; }
.event-modal-overlay.active { opacity: 1; visibility: visible; }

.event-modal-header { padding: 2rem; text-align: center; border-bottom: 2px solid rgba(120,61,102,0.2); }
[data-theme="dark"] .event-modal-header { border-bottom-color: rgba(196,122,170,0.2); }
.event-modal-header h3 { font-size: 1.5rem; font-weight: 700; color: var(--rpt-modal-h3); margin-bottom: 0.5rem; transition: color 0.3s ease; }
.event-modal-header p { font-size: 1.1rem; color: var(--rpt-modal-p); transition: color 0.3s ease; }

.event-modal-content { padding: 2rem; flex: 1; }
.event-modal-actions { padding: 1.5rem 2rem; display: flex; flex-direction: column; gap: 1rem; }

.btn-modal { width: 100%; padding: 1rem; border: none; border-radius: 12px; font-weight: 600; font-size: 1rem; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.6rem; transition: all 0.3s ease; }
.btn-modal svg { width: 20px; height: 20px; }

.btn-modal-view { background: #783d66; color: white; }
.btn-modal-view:hover { background: #5a2d4d; transform: translateY(-2px); box-shadow: 0 6px 16px rgba(120,61,102,0.4); }

.btn-modal-print { background: var(--rpt-btn-bg); color: #783d66; border: 2px solid #783d66; }
[data-theme="dark"] .btn-modal-print { color: #c47aaa; border-color: #c47aaa; }
.btn-modal-print:hover { background: var(--rpt-bg-soft); transform: translateY(-2px); }

.btn-modal-edit { background: var(--rpt-btn-bg); color: #4299e1; border: 2px solid #4299e1; }
[data-theme="dark"] .btn-modal-edit { background: rgba(66,153,225,0.1); }
.btn-modal-edit:hover { background: #4299e1; color: white; transform: translateY(-2px); }

.btn-close-modal { position: absolute; top: 1.5rem; right: 1.5rem; width: 36px; height: 36px; border: none; background: var(--rpt-close-bg); border-radius: 8px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease; color: var(--rpt-text-sub); }
.btn-close-modal:hover { transform: rotate(90deg); color: var(--rpt-text); }
.btn-close-modal svg { width: 20px; height: 20px; }

/* CREAR INFORME */
.create-form { background: var(--rpt-bg); border-radius: 20px; padding: 2.5rem; box-shadow: var(--rpt-shadow); border: 1px solid var(--rpt-border); transition: background 0.3s ease, border-color 0.3s ease; }
.form-row { display: grid; grid-template-columns: repeat(2, 1fr); gap: 2rem; margin-bottom: 2rem; }
.form-group { display: flex; flex-direction: column; }
.form-group label { font-weight: 600; color: var(--rpt-text); margin-bottom: 0.75rem; font-size: 0.95rem; transition: color 0.3s ease; }

.input-with-icon { position: relative; display: flex; align-items: center; }
.input-with-icon input { flex: 1; padding: 1rem 3.5rem 1rem 1.2rem; border: 2px solid var(--rpt-border); border-radius: 12px; font-size: 1rem; transition: all 0.3s ease; background: var(--rpt-input-bg); color: var(--rpt-text); }
.input-with-icon input:focus { outline: none; border-color: #783d66; background: var(--rpt-bg); }

.btn-edit-input, .btn-calendar { position: absolute; right: 8px; width: 36px; height: 36px; border: none; background: transparent; border-radius: 8px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease; color: #783d66; }
[data-theme="dark"] .btn-edit-input, [data-theme="dark"] .btn-calendar { color: var(--rpt-text); }
.btn-edit-input:hover, .btn-calendar:hover { background: #783d66; color: white; }
.btn-edit-input svg, .btn-calendar svg { width: 18px; height: 18px; }

.table-section { margin-top: 2rem; border-radius: 16px; overflow: hidden; border: 2px solid var(--rpt-border); transition: border-color 0.3s ease; }
.table-header { display: grid; grid-template-columns: 80px 2fr 1.5fr; background: linear-gradient(135deg, #783d66 0%, #5a2d4d 100%); color: white; font-weight: 600; font-size: 0.95rem; }
.table-col { padding: 1rem; text-align: center; }
.table-body { background: var(--rpt-table-bg); transition: background 0.3s ease; }
.table-row { display: grid; grid-template-columns: 80px 2fr 1.5fr; border-bottom: 1px solid var(--rpt-border); transition: background 0.3s ease; }
.table-row:hover { background: var(--rpt-row-hover); }
.table-cell { padding: 1rem; display: flex; align-items: center; justify-content: center; color: var(--rpt-text);}
.table-cell input { width: 100%; padding: 0.6rem; border: 1px solid var(--rpt-border); border-radius: 8px; font-size: 0.9rem; transition: all 0.3s ease; background: var(--rpt-input-bg); color: var(--rpt-text); }
.table-cell input:focus { outline: none; border-color: #783d66; background: var(--rpt-bg); }

.form-actions { display: flex; gap: 1rem; margin-top: 2rem; justify-content: flex-end; }
.btn-form { padding: 1rem 2rem; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 0.6rem; transition: all 0.3s ease; box-shadow: var(--rpt-shadow-btn); }
.btn-form svg { width: 20px; height: 20px; }

.btn-export { background: var(--rpt-btn-bg); color: #4299e1; border: 2px solid #4299e1; }
[data-theme="dark"] .btn-export { background: rgba(66,153,225,0.1); }
.btn-export:hover { background: #4299e1; color: white; transform: translateY(-2px); }

.btn-print { background: var(--rpt-btn-bg); color: #48bb78; border: 2px solid #48bb78; }
[data-theme="dark"] .btn-print { background: rgba(72,187,120,0.1); }
.btn-print:hover { background: #48bb78; color: white; transform: translateY(-2px); }

.btn-save { background: linear-gradient(135deg, #783d66 0%, #5a2d4d 100%); color: white; }
.btn-save:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(120,61,102,0.3); }

/* HISTORIAL */
.history-filters { display: flex; gap: 1rem; }
.filter-btn { padding: 0.7rem 1.5rem; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; background: var(--rpt-filter-bg); color: var(--rpt-filter-color); }
.filter-btn.active { background: #783d66; color: white; }
.filter-btn:hover { transform: translateY(-2px); }

.history-list { display: flex; flex-direction: column; gap: 2rem; }
.history-group { display: flex; flex-direction: column; gap: 1rem; }

.history-item { background: var(--rpt-history-bg); border-radius: 16px; padding: 1.5rem 2rem; display: flex; align-items: center; justify-content: space-between; transition: all 0.3s ease; cursor: pointer; }
.history-item.highlight { background: var(--rpt-bg-soft); }
[data-theme="dark"] .history-item.highlight { background: #1a2035; }
.history-item.accent { background: linear-gradient(135deg, #d8a7ce 0%, #c48db8 100%); }
[data-theme="dark"] .history-item.accent { background: linear-gradient(135deg, rgba(155,77,119,0.3) 0%, rgba(120,61,102,0.2) 100%); border: 1px solid rgba(155,77,119,0.3); }
.history-item:hover { transform: translateX(8px); box-shadow: 0 6px 20px rgba(120,61,102,0.2); }

.history-content h4 { font-size: 1.1rem; font-weight: 600; color: var(--rpt-history-h4); margin-bottom: 0.3rem; transition: color 0.3s ease; }
.history-date { font-size: 0.95rem; color: var(--rpt-history-date); font-weight: 500; transition: color 0.3s ease; }

.btn-print-small { width: 44px; height: 44px; border: 1px solid var(--rpt-border); background: var(--rpt-btn-bg); border-radius: 10px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease; flex-shrink: 0; color: var(--rpt-text-sub); }
.btn-print-small:hover { background: #783d66; transform: scale(1.1); border-color: #783d66; color: white; }
.btn-print-small svg { width: 22px; height: 22px; }

/* REDUCE ANIMATIONS */
body.reduce-animations .view-section { animation: none !important; }
body.reduce-animations .btn-action, body.reduce-animations .btn-form, body.reduce-animations .btn-modal, body.reduce-animations .history-item, body.reduce-animations .calendar-date { transition-duration: 0.1s !important; }
body.reduce-animations .history-item:hover { transform: translateX(3px) !important; }
body.reduce-animations .calendar-date:hover { transform: none !important; }

@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

@media (max-width: 1024px) { 
    .calendar-wrapper { grid-template-columns: 1fr; gap: 2rem; max-width: 600px; }
    .calendar-header { grid-column: 1; }
    .calendar-grid { grid-column: 1; max-width: 100%; }
    .calendar-notes { 
        grid-column: 1; 
        border-left: none; 
        border-top: 2px solid var(--rpt-border); 
        padding-left: 0; 
        padding-top: 1.5rem; 
    }
}

@media (max-width: 768px) {
    .reports-container { padding: 1rem; }
    .reports-header { flex-direction: column; align-items: flex-start; gap: 1rem; }
    .reports-header h2 { font-size: 1.5rem; }
    .header-actions { flex-direction: column; width: 100%; margin-left: 0; }
    .btn-action { width: 100%; justify-content: center; }
    .calendar-wrapper { padding: 0.75rem; border-radius: 16px; }
    .calendar-header { margin-bottom: 1rem; }
    .calendar-header h3 { font-size: 1.1rem; }
    .btn-nav { width: 32px; height: 32px; }
    .btn-nav svg { width: 16px; height: 16px; }
    .calendar-days { gap: 0.15rem; }
    .day-header { padding: 0.35rem 0.1rem; font-size: 0.65rem; }
    .day-full { display: none; }
    .day-short { display: inline; }
    .calendar-dates { gap: 0.15rem; }
    .calendar-date { font-size: 0.75rem; min-height: 32px; border-radius: 6px; }
    .calendar-date.has-event::after { width: 3px; height: 3px; bottom: 2px; }
    .calendar-notes { display: none; }
    .event-modal { max-width: 100%; }
    .event-modal-header { padding: 1.5rem; }
    .event-modal-header h3 { font-size: 1.3rem; }
    .event-modal-content { padding: 1.5rem; }
    .form-row { grid-template-columns: 1fr; gap: 1.5rem; }
    .create-form { padding: 1.5rem; }
    .table-section { overflow-x: auto; -webkit-overflow-scrolling: touch; }
    .table-header, .table-row { grid-template-columns: 60px 1.5fr 1fr; min-width: 520px; }
    .table-col, .table-cell { padding: 0.75rem 0.5rem; font-size: 0.85rem; }
    .table-cell input { padding: 0.5rem; font-size: 0.85rem; }
    .form-actions { flex-direction: column; }
    .btn-form { width: 100%; justify-content: center; }
    .history-filters { flex-wrap: wrap; width: 100%; }
    .filter-btn { flex: 1; min-width: 100px; padding: 0.6rem 1rem; font-size: 0.9rem; }
    .history-item { padding: 1.25rem 1.5rem; flex-direction: column; align-items: flex-start; gap: 1rem; }
    .history-content h4 { font-size: 1rem; }
    .btn-print-small { align-self: flex-end; }
}

@media (max-width: 480px) {
    .calendar-wrapper { padding: 0.5rem; }
    .calendar-header h3 { font-size: 1rem; }
    .day-header { font-size: 0.6rem; padding: 0.3rem 0.05rem; }
    .calendar-date { font-size: 0.7rem; min-height: 28px; }
    .btn-nav { width: 28px; height: 28px; }
    .btn-nav svg { width: 14px; height: 14px; }
    .btn-action { padding: 0.75rem 1.25rem; font-size: 0.9rem; }
    .btn-action svg { width: 18px; height: 18px; }
    .table-header, .table-row { grid-template-columns: 50px 1.5fr 1fr; }
}